"use strict";(()=>{var g=(o,t,e)=>new Promise((s,i)=>{var E=a=>{try{r(e.next(a))}catch(S){i(S)}},p=a=>{try{r(e.throw(a))}catch(S){i(S)}},r=a=>a.done?s(a.value):Promise.resolve(a.value).then(E,p);r((e=e.apply(o,t)).next())});var T={GET_SETTINGS:"storage_get_settings",SET_SETTINGS:"storage_set_settings",EXPORT:"export",PR_CREATED:"pr_created"};var L={VALID_CHILD_TYPES:["PAGE"]},x=["COMPONENT"],w={COMPONENT_NAME:"COMPONENT_NAME",PARENT_NAME:"PARENT_NAME",SET_OR_COMPONENT_NAME:"SET_OR_COMPONENT_NAME",SF_ALTERNATIVE:"SF_ALTERNATIVE",RTL:"RTL",WEIGHT:"WEIGHT",COLOR:"COLOR",STATE:"STATE",SIZE:"SIZE"},G={WEIGHT:"weight",COLOR:"color",RTL:"right to left",SF_ALTERNATIVE:"sf alternative",STATE:"state",SIZE:"size"},n={DOCUMENT:L,SEARCH_CRITERIA:x,REPLACE_TERMS:w,FIGMA_VARIANTS:G};var c=o=>o?Object.keys(o).reduce((t,e)=>{let s=e.toLowerCase(),i=o[e].toLowerCase();return t[s]=i,t},{}):{};var m=class{constructor(t,e,s){this.node=t,this.destination=e,this.assetSetting=s,this.variants=c(this.node.variantProperties)}get replacementMap(){var p,r,a,S,d,f,N,C,R;let t=((p=this.node.parent)==null?void 0:p.type)==="COMPONENT_SET"?this.node.parent.name:this.node.name,e=((r=this.variants)==null?void 0:r[n.FIGMA_VARIANTS.RTL])==="true"?"rtl":void 0,s=((a=this.variants)==null?void 0:a[n.FIGMA_VARIANTS.SF_ALTERNATIVE])==="true"?"sf":void 0,i=((S=this.variants)==null?void 0:S[n.FIGMA_VARIANTS.SIZE])==="default"||(d=this.variants)==null?void 0:d[n.FIGMA_VARIANTS.SIZE];return{[n.REPLACE_TERMS.COMPONENT_NAME]:this.node.name,[n.REPLACE_TERMS.PARENT_NAME]:(f=this.node.parent)==null?void 0:f.name,[n.REPLACE_TERMS.SET_OR_COMPONENT_NAME]:t,[n.REPLACE_TERMS.WEIGHT]:(N=this.variants)==null?void 0:N[n.FIGMA_VARIANTS.WEIGHT],[n.REPLACE_TERMS.STATE]:(C=this==null?void 0:this.variants)==null?void 0:C[n.FIGMA_VARIANTS.STATE],[n.REPLACE_TERMS.COLOR]:(R=this.variants)==null?void 0:R[n.FIGMA_VARIANTS.COLOR],[n.REPLACE_TERMS.SIZE]:i,[n.REPLACE_TERMS.RTL]:e,[n.REPLACE_TERMS.SF_ALTERNATIVE]:s}}get assetName(){let t="",{fileName:e,exportSettings:s}=this.assetSetting.input.asset,i=e.parts.reduce((p,r)=>{let a=this.replacementMap[r];return a&&p.push(a),p},[]);return t+=i.join(e.separator),e.suffix.parts.forEach(p=>{var a;let r=(a=this.replacementMap)==null?void 0:a[p];r&&(t+=e.suffix.separator,t+=r)}),t.endsWith("-black")&&(t=t.replace("-black","")),t+=".",t+=s.format,t.toLowerCase()}get asset(){return new Promise((t,e)=>{this.node.exportAsync(this.assetSetting.input.asset.exportSettings).then(s=>{t({path:`${this.destination?`${this.destination}/`:""}${this.assetName}`,data:String.fromCharCode.apply(null,s)})}).catch(s=>{figma.notify(s,{error:!0}),e(s)})})}},_=m;var u=class{constructor(t,e,s){this.node=t,this.destination=e,this.assetSetting=s}get assets(){return Promise.all(this.components.map(t=>t.asset))}excludeComponents(t){let{exclude:e}=this.assetSetting.input;return e?t.filter(s=>{var i;return((i=c(s.variantProperties))==null?void 0:i[e.byVariant])!=="true"}):t}get components(){let t=this.node.findAllWithCriteria({types:n.SEARCH_CRITERIA});return this.excludeComponents(t).map(s=>new _(s,this.destination,this.assetSetting))}},I=u;var h=class{constructor(t,e){this.node=t,this.assetSetting=e}getDestination(t,e){let s=e.find(i=>t.toLowerCase().includes(i.page.toLowerCase()));return s==null?void 0:s.folder}get pages(){let t=[];if("children"in this.node){for(let e of this.node.children)if(n.DOCUMENT.VALID_CHILD_TYPES.includes(e.type)){let s=this.getDestination(e.name,this.assetSetting.input.mapPagesToFolder);(s||s==="")&&t.push(new I(e,s,this.assetSetting))}}return t}createChunks(t){let s=[];for(let i=0;i<t.length;i+=500)s.push(t.slice(i,i+500));return s}getAssetChunksFromPages(){return g(this,null,function*(){if(!this.pages.length)return[[]];let t=[];return yield Promise.all(this.pages.map(e=>e.assets.then(s=>{t.push(...s)}))),this.createChunks(t)})}},y=h;var F={auth:{githubPersonalToken:"<YourClassicPersonalAccessTokenHere>"},assets:{typeOfAsset:{name:"<type of asset>",description:{name:"<Name of git repo>",url:"<URL of the git repo only for informational purpose>",urlText:"<url text>"},input:{mapPagesToFolder:[{page:"<substring of page>",folder:"<folder-name>"}],exclude:{byVariant:"<variant which should be excluded>"},asset:{fileName:{parts:["SET_OR_COMPONENT_NAME","SF_ALTERNATIVE","RTL"],separator:"-",suffix:{parts:["WEIGHT","STATE","SIZE"],separator:"_"}},exportSettings:{format:"SVG",contentsOnly:!0,useAbsoluteBounds:!1}}},output:{git:{githubOwner:"<owner-name>",gitRepo:"<repo-name>",gitBranch:`automation-assets-${new Date().toISOString().replace(/\.|:/g,"-")}`,prTitle:`Automated Assets Export ${new Date().toISOString()}`,prCommitMsg:`feat(assets): Export ${new Date().toISOString()}`,prMessage:`feat(assets): Export ${new Date().toISOString()}`,gitRepoFilePath:"<path where assets should be exported to>"}}}}},P={INITIAL_SETTINGS:F};var O="settings",l=class{constructor(){this.initialSettings=P.INITIAL_SETTINGS;this.api=figma.clientStorage}setSettings(t){return g(this,null,function*(){return this.api.setAsync(O,t)})}getSettings(){return g(this,null,function*(){return this.api.getAsync(O)})}},M=l;var A=new M;figma.on("run",()=>g(void 0,null,function*(){(yield A.getSettings())||(yield A.setSettings(A.initialSettings))}));figma.skipInvisibleInstanceChildren=!0;figma.showUI(__html__,{themeColors:!0,height:550,width:450});figma.ui.onmessage=o=>g(void 0,null,function*(){var t,e;if(o.type===T.EXPORT){let i=yield new y(figma.root,o.assetSetting).getAssetChunksFromPages();figma.ui.postMessage({type:"assets",data:i},{origin:"*"}),figma.ui.postMessage({type:"export"},{origin:"*"})}if(o.type===T.SET_SETTINGS&&(figma.ui.postMessage({type:"storage",data:"inprogress"},{origin:"*"}),yield A.setSettings(o.settings),figma.ui.postMessage({type:"storage",data:"complete"},{origin:"*"})),o.type===T.GET_SETTINGS){let s=yield A.getSettings();figma.ui.postMessage({type:"settings",data:s},{origin:"*"})}o.type===T.PR_CREATED&&figma.notify(`Pull Request: ${(e=(t=o.pullRequest)==null?void 0:t.data)==null?void 0:e.url}`)});})();
